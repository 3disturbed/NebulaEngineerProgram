{
    "id": "lesson-6e",
    "title": "Lesson 6e: Deployment & Production Ready",
    "steps": [
        {
            "title": "Environment Configuration",
            "content": "<p>Separate development settings from production using environment variables:</p><div class=\"code-block\"><code class=\"language-bash\">npm install dotenv</code></div><p style=\"margin-top: 15px;\"><strong>Create .env file:</strong></p><div class=\"code-block\"><code class=\"language-text\"># Development\nNODE_ENV=development\nPORT=3000\nAPI_URL=http://localhost:3000\n\n# Production\n# NODE_ENV=production\n# PORT=5000\n# API_URL=https://api.yourdomain.com\n\n# Database\nDB_PATH=./market.db\n\n# Security\nAPI_KEYS=key-demo-12345,key-prod-67890\nRATE_LIMIT=100\n\n# Logging\nLOG_LEVEL=info</code></div><p style=\"margin-top: 15px;\"><strong>Use in code:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">require('dotenv').config();\n\nconst PORT = process.env.PORT || 3000;\nconst NODE_ENV = process.env.NODE_ENV || 'development';\nconst API_URL = process.env.API_URL;\n\nif (NODE_ENV === 'production') {\n    // Use production settings\n    console.log('ðŸš€ Running in PRODUCTION mode');\n} else {\n    // Use development settings\n    console.log('ðŸ”§ Running in DEVELOPMENT mode');\n}\n\nserver.listen(PORT, () => {\n    console.log(`Server running on ${API_URL}`);\n});</code></div><div class=\"read-more\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage\" target=\"_blank\">MDN: Environment Variables</a> - Secure configuration</div>"
        },
        {
            "title": "Logging & Monitoring",
            "content": "<p>Track what your server is doing with proper logging:</p><div class=\"code-block\"><code class=\"language-bash\">npm install winston</code></div><p style=\"margin-top: 15px;\"><strong>Set up logging:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">const winston = require('winston');\n\nconst logger = winston.createLogger({\n    level: process.env.LOG_LEVEL || 'info',\n    format: winston.format.json(),\n    transports: [\n        // Log to console\n        new winston.transports.Console({\n            format: winston.format.simple()\n        }),\n        // Log to file\n        new winston.transports.File({ \n            filename: 'logs/error.log', \n            level: 'error' \n        }),\n        new winston.transports.File({ \n            filename: 'logs/combined.log' \n        })\n    ]\n});\n\n// Use throughout app\nlogger.info('âœ“ Market service started');\nlogger.warn('âš  Rate limit approaching');\nlogger.error('âŒ Failed to update prices', { error });\n\n// Log API requests\napp.use((req, res, next) => {\n    logger.info(`${req.method} ${req.path}`, {\n        ip: req.ip,\n        client: req.client?.name || 'unknown'\n    });\n    next();\n});</code></div><div class=\"hint\"><strong>Creates log files:</strong><br>â€¢ <code>logs/error.log</code> - Errors only<br>â€¢ <code>logs/combined.log</code> - All messages</div><div class=\"read-more\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Console/error\" target=\"_blank\">MDN: Console.error()</a> - Error logging</div>"
        },
        {
            "title": "Docker Containerization",
            "content": "<p>Package your app as a Docker container for consistent deployment:</p><div class=\"code-block\"><code class=\"language-dockerfile\">FROM node:18-alpine\n\n# Set working directory\nWORKDIR /app\n\n# Copy files\nCOPY package*.json ./\nCOPY . .\n\n# Install dependencies\nRUN npm install\n\n# Expose port\nEXPOSE 3000\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\\n  CMD node -e \"require('http').get('http://localhost:3000/health', (r) => {if (r.statusCode !== 200) throw new Error(r.statusCode)})\" \n\n# Start app\nCMD [\"npm\", \"start\"]</code></div><p style=\"margin-top: 15px;\"><strong>Build and run:</strong></p><div class=\"code-block\"><code class=\"language-bash\"># Build image\ndocker build -t market-service:1.0 .\n\n# Run container\ndocker run -d -p 3000:3000 --name market-service market-service:1.0\n\n# View logs\ndocker logs market-service\n\n# Stop container\ndocker stop market-service</code></div><div class=\"read-more\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/200\" target=\"_blank\">MDN: HTTP 200 OK</a> - Health check response</div>"
        },
        {
            "title": "Health Checks & Graceful Shutdown",
            "content": "<p>Make your service reliable and safe to restart:</p><div class=\"code-block\"><code class=\"language-javascript\">// Health check endpoint\napp.get('/health', (req, res) => {\n    const health = {\n        status: 'up',\n        timestamp: new Date().toISOString(),\n        uptime: process.uptime(),\n        environment: process.env.NODE_ENV,\n        connectedClients: connectedClients,\n        memoryUsage: process.memoryUsage()\n    };\n    res.json(health);\n});\n\n// Graceful shutdown\nfunction gracefulShutdown() {\n    logger.info('Received shutdown signal, closing gracefully...');\n    \n    // Stop accepting new connections\n    server.close(() => {\n        logger.info('HTTP server closed');\n    });\n    \n    // Close WebSocket connections\n    io.close();\n    logger.info('WebSocket connections closed');\n    \n    // Save any pending data\n    database.write('lastShutdown', new Date().toISOString());\n    logger.info('Data saved');\n    \n    // Wait up to 10 seconds for connections to close\n    setTimeout(() => {\n        logger.error('Forced shutdown after timeout');\n        process.exit(1);\n    }, 10000);\n}\n\n// Listen for shutdown signals\nprocess.on('SIGTERM', gracefulShutdown);\nprocess.on('SIGINT', gracefulShutdown);</code></div><div class=\"hint\"><strong>Why graceful shutdown matters:</strong><br>â€¢ Finish in-progress requests<br>â€¢ Save pending data<br>â€¢ Close database connections<br>â€¢ Avoid data corruption</div><div class=\"read-more\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Server\" target=\"_blank\">MDN: process.on()</a> - Signal handling</div>"
        },
        {
            "title": "Deployment Checklist",
            "content": "<p><strong>Before deploying to production:</strong></p><div class=\"hint\"><strong>âœ“ Code Quality</strong><br>â€¢ All tests passing<br>â€¢ No console.log() statements (use logger)<br>â€¢ Proper error handling everywhere<br>â€¢ Code reviewed by another developer<br><br><strong>âœ“ Security</strong><br>â€¢ API keys are environment variables<br>â€¢ Database is secured<br>â€¢ HTTPS enabled<br>â€¢ Rate limiting configured<br>â€¢ CORS set to specific origins<br><br><strong>âœ“ Monitoring</strong><br>â€¢ Logging configured<br>â€¢ Health check endpoint working<br>â€¢ Alert system set up<br>â€¢ Metrics collection ready<br><br><strong>âœ“ Performance</strong><br>â€¢ Load tested<br>â€¢ Database optimized<br>â€¢ Caching implemented<br>â€¢ CDN configured<br><br><strong>âœ“ Operations</strong><br>â€¢ Deployment script ready<br>â€¢ Rollback plan documented<br>â€¢ Backup strategy in place<br>â€¢ Runbooks written</div>"
        },
        {
            "title": "Lesson 6e Complete! ðŸŽ‰",
            "content": "<p style=\"font-size: 1.2em; font-weight: bold;\">You've built a production-ready microservice!</p><div style=\"margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;\"><h3 style=\"margin: 0 0 10px 0;\">âœ¨ What You Accomplished in Lesson 6:</h3><ul style=\"margin: 10px 0 10px 20px; color: white;\"><li>6a: Built REST API with Express.js</li><li>6b: Added advanced endpoints & filtering</li><li>6c: Implemented authentication & security</li><li>6d: Added real-time WebSocket updates</li><li>6e: Deployed and maintained production systems</li></ul></div><p style=\"margin-top: 20px;\"><strong>You can now:</strong></p><ul style=\"margin: 10px 0 10px 20px;\"><li>âœ… Build scalable microservices</li><li>âœ… Secure APIs with authentication</li><li>âœ… Handle real-time data with WebSockets</li><li>âœ… Deploy to production safely</li><li>âœ… Monitor and maintain services</li><li>âœ… Build professional Node.js applications</li></ul><div style=\"margin-top: 25px; padding: 15px; background: #2a2e47; border-left: 4px solid #f9e2af; border-radius: 8px;\"><p style=\"margin: 0;\"><strong>ðŸš€ Your Journey Continues!</strong> You've learned the fundamentals of microservice architecture. Next steps: explore databases (MongoDB, PostgreSQL), containerization (Docker Compose), and orchestration (Kubernetes).</p></div>"
        }
    ]
}
