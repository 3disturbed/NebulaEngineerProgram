{
    "id": "lesson-2",
    "title": "Lesson 2: Database Wrapper",
    "steps": [
        {
            "title": "The Database Dilemma",
            "content": "<p>We need a way to store data. A real database (Postgres, Mongo) is overkill for a prototype. Text files are simple, but dangerous.</p><div class=\"info-box\"><strong>Why JSON files?</strong><br>â€¢ Simple to debug (just open in VS Code)<br>â€¢ No installation required<br>â€¢ Perfect for single-process apps</div><p><strong>The Risk:</strong> If your program crashes while writing to a file, that file becomes <strong>corrupted</strong> (half-written garbage). We need a safe way to write files.</p>"
        },
        {
            "title": "The Safe Write Pattern",
            "content": "<p>To prevent corruption, we use the <strong>Write-to-Temp-then-Rename</strong> pattern:</p><ol><li>Write data to a temporary file (e.g., <code>markets.json.tmp</code>)</li><li>Verify the write finished successfully</li><li><strong>Rename</strong> the temp file to the real filename (<code>markets.json</code>)</li></ol><p><strong>Why this works:</strong> Renaming a file is an <strong>atomic operation</strong> in the OS. It happens instantly. You either have the old file or the new file, never a broken half-file.</p>"
        },
        {
            "title": "Create database.js",
            "content": "<p>Create <code>src/database.js</code>:</p><div class=\"code-block\"><code class=\"language-javascript\">const fs = require('fs').promises;\nconst path = require('path');\n\nclass Database {\n    constructor(dataDir) {\n        this.dataDir = dataDir;\n    }\n\n    async saveFile(filename, data) {\n        const filePath = path.join(this.dataDir, filename);\n        const tempPath = filePath + '.tmp';\n\n        // 1. Write to temp file\n        await fs.writeFile(tempPath, JSON.stringify(data, null, 2));\n\n        // 2. Rename temp to real (Atomic!)\n        await fs.rename(tempPath, filePath);\n        \n        console.log(`Saved ${filename} safely.`);\n    }\n\n    async readFile(filename) {\n        try {\n            const filePath = path.join(this.dataDir, filename);\n            const data = await fs.readFile(filePath, 'utf8');\n            return JSON.parse(data);\n        } catch (error) {\n            return null; // File doesn't exist yet\n        }\n    }\n}\n\nmodule.exports = new Database('./data');</code></div><div class=\"read-more\" style=\"margin-top: 15px; font-size: 0.9em;\"><strong>Read more on MDN:</strong><ul style=\"margin-top: 5px;\"><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify\" target=\"_blank\">JSON.stringify()</a></li><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse\" target=\"_blank\">JSON.parse()</a></li><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\" target=\"_blank\">Promise</a></li></ul></div><button class=\"btn btn-lab\" onclick=\"openLab('labBtn-2-0')\">ðŸ§ª Try the Safe Write Lab</button>"
        }
    ]
}