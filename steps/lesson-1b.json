{
    "id": "lesson-1b",
    "title": "Lesson 1b: TimeService",
    "steps": [
        {
            "title": "Why HSL (Hours Since Launch)?",
            "content": "<p>Regular dates are a NIGHTMARE:</p><ul style=\"margin: 10px 0 10px 20px;\"><li>38 different timezones (why?!)</li><li>Daylight savings time is evil</li><li>Server migrations break everything</li><li>Players in different locations see different times</li></ul><p style=\"margin-top: 15px;\"><strong>HSL is simple:</strong> One number = hours since launch</p><div class=\"info-box\">If game launches Dec 5, 2025 at midnight:<br>Dec 5, 1 AM = HSL 1<br>Dec 5, 2 PM = HSL 14<br>Dec 10, noon = HSL 108.5 â†’ rounded down to 108</div>"
        },
        {
            "title": "Create TimeService.js",
            "content": "<p>Create <strong>src\\services\\TimeService.js</strong>:</p><div class=\"code-block\"><code class=\"language-javascript\">// src/services/TimeService.js\n// ==============================\n// TimeService calculates Hours Since Launch (HSL)\n// This is the CORE time system for your entire game\n\nclass TimeService {\n  constructor() {\n    // CRITICAL: Game launched at this exact moment\n    // December 5, 2025, midnight UTC (Z = Zulu = UTC)\n    // DO NOT CHANGE THIS WITHOUT WIPING YOUR DATABASE!\n    // If you change launch date, everything breaks forever\n    this.launchDate = new Date('2025-12-05T00:00:00Z');\n  }\n  \n  /**\n   * Get Hours Since Launch (HSL)\n   * \n   * @returns {number} Hours since game launch (always an integer)\n   * \n   * This is the MOST IMPORTANT METHOD in your entire game.\n   * Markets use it. History uses it. Events use it.\n   * If this lies to you, EVERYTHING breaks.\n   */\n  getHoursSinceLaunch() {\n    // Step 1: Get current time from system clock\n    const now = new Date();\n    \n    // Step 2: Calculate milliseconds since launch\n    const millisecondsSinceLaunch = now - this.launchDate;\n    \n    // Step 3: Convert milliseconds to hours\n    // Formula: ms / (1000 ms/sec Ã— 60 sec/min Ã— 60 min/hour)\n    //        = ms / 3,600,000\n    const hours = millisecondsSinceLaunch / (1000 * 60 * 60);\n    \n    // Step 4: Round DOWN to whole hours\n    // Math.floor() always rounds DOWN (never up)\n    // If it's 13:47, you're still in hour 13, not 14\n    return Math.floor(hours);\n  }\n  \n  /**\n   * Check if it's the top of the hour\n   * \n   * Returns true if we're at minute 0-1 of the hour.\n   * Why minute 0 OR 1? Because we might miss exact :00\n   * if our code is busy. This gives us a 2-minute window.\n   * \n   * @returns {boolean} True if minute is 0 or 1\n   */\n  isTopOfHour() {\n    const now = new Date();\n    const minutes = now.getMinutes();  // 0-59\n    return minutes === 0 || minutes === 1;\n  }\n}\n\n// Export a singleton instance\n// Everyone uses the SAME TimeService\n// There's only ONE clock in your game, not many\nmodule.exports = new TimeService();</code></div><div class=\"read-more\" style=\"margin-top: 15px; font-size: 0.9em;\"><strong>Read more on MDN:</strong><ul style=\"margin-top: 5px;\"><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date\" target=\"_blank\">Date</a></li><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/floor\" target=\"_blank\">Math.floor()</a></li><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getMinutes\" target=\"_blank\">Date.prototype.getMinutes()</a></li></ul></div>"
        },
        {
            "title": "Understanding the Math",
            "content": "<p><strong>Converting milliseconds to hours:</strong></p><div class=\"code-block\"><code class=\"language-text\">1000 milliseconds = 1 second\n60 seconds = 1 minute\n60 minutes = 1 hour\n\nTherefore: 1000 Ã— 60 Ã— 60 = 3,600,000 milliseconds per hour\n\nTo convert: milliseconds Ã· 3,600,000 = hours</code></div><p style=\"margin-top: 15px;\"><strong>Math.floor() always rounds DOWN:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">Math.floor(13.1)   // â†’ 13\nMath.floor(13.5)   // â†’ 13 (not 14!)\nMath.floor(13.9)   // â†’ 13 (still not 14!)\nMath.floor(14.0)   // â†’ 14\nMath.floor(14.001) // â†’ 14</code></div><div class=\"read-more\" style=\"margin-top: 15px; font-size: 0.9em;\"><strong>Read more on MDN:</strong><ul style=\"margin-top: 5px;\"><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/floor\" target=\"_blank\">Math.floor()</a></li></ul></div><p style=\"margin-top: 15px;\">Why? Because if it's 13:47, you're still in hour 13. Only at 14:00 do you enter hour 14.</p><button class=\"btn btn-lab\" id=\"labBtn-1b-0\" onclick=\"openLab('labBtn-1b-0')\">ðŸ§ª Try the Math Lab</button>"
        },
        {
            "title": "Create test-time.js",
            "content": "<p>Create <strong>test-time.js</strong> in the root folder:</p><div class=\"code-block\"><code class=\"language-javascript\">// test-time.js\n// ===============\n// Test our TimeService implementation\n\nconst TimeService = require('./src/services/TimeService');\n\nconsole.log('=== Time Service Test ===\\n');\n\n// Test 1: Get current HSL\nconst hsl = TimeService.getHoursSinceLaunch();\nconsole.log('Current HSL:', hsl, 'hours since launch');\n\n// Test 2: Check if it's top of hour\nconst isTop = TimeService.isTopOfHour();\nconsole.log('Is top of hour?:', isTop);\n\n// Test 3: Show current local time\nconst now = new Date().toLocaleTimeString();\nconsole.log('Your local time:', now);\n\n// Test 4: Show launch date\nconst launchDate = new Date('2025-12-05T00:00:00Z');\nconsole.log('Game launched:', launchDate.toUTCString());\n\n// Test 5: Calculate some examples\nconsole.log('\\n--- Mathematical Examples ---');\nconst examples = [\n  { ms: 3600000, label: '1 hour = 3,600,000 ms' },\n  { ms: 7200000, label: '2 hours = 7,200,000 ms' },\n  { ms: 10800000, label: '3 hours = 10,800,000 ms' }\n];\n\nexamples.forEach(ex => {\n  const hours = ex.ms / (1000 * 60 * 60);\n  const floored = Math.floor(hours);\n  console.log(ex.label + ' = ' + hours + ' hours = Math.floor() = ' + floored);\n});</code></div><div class=\"read-more\" style=\"margin-top: 15px; font-size: 0.9em;\"><strong>Read more on MDN:</strong><ul style=\"margin-top: 5px;\"><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleTimeString\" target=\"_blank\">Date.prototype.toLocaleTimeString()</a></li><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toUTCString\" target=\"_blank\">Date.prototype.toUTCString()</a></li><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach\" target=\"_blank\">Array.prototype.forEach()</a></li></ul></div><p style=\"margin-top: 15px;\">Run it:</p><div class=\"command\">node test-time.js</div><button class=\"btn btn-lab\" id=\"labBtn-1b-1\" onclick=\"openLab('labBtn-1b-1')\">ðŸ§ª Try the Test Lab</button>"
        },
        {
            "title": "Your First Test!",
            "content": "<p>You should see output like:</p><div class=\"code-block\"><code class=\"language-text\">=== Time Service Test ===\n\nCurrent HSL: 13 hours since launch\nIs top of hour?: false\nYour local time: 1:47:32 PM\nGame launched: Wed Dec 05 2025 00:00:00 GMT\n\n--- Mathematical Examples ---\n1 hour = 3,600,000 ms = 1 hours = Math.floor() = 1\n2 hours = 7,200,000 ms = 2 hours = Math.floor() = 2\n3 hours = 10,800,000 ms = 3 hours = Math.floor() = 3</code></div>"
        },
        {
            "title": "Knowledge Check",
            "content": "<p>Verify your understanding of the TimeService.</p>",
            "quiz": [
                {
                    "question": "Why do we use Math.floor() for HSL?",
                    "options": [
                        "To round to the nearest hour",
                        "To always round down to the current hour",
                        "To always round up to the next hour"
                    ],
                    "correct": 1
                },
                {
                    "question": "How many milliseconds are in one hour?",
                    "options": [
                        "60,000",
                        "360,000",
                        "3,600,000"
                    ],
                    "correct": 2
                }
            ]
        },
        {
            "title": "Lesson 1b Complete! ðŸŽ‰",
            "content": "<p style=\"font-size: 1.1em;\"><strong>You have successfully built the TimeService.</strong></p><div style=\"margin: 20px 0;\"><div class=\"achievement\">âœ“ Implemented HSL calculation</div><div class=\"achievement\">âœ“ Created singleton service</div><div class=\"achievement\">âœ“ Verified with test script</div></div><p style=\"margin-top: 20px; color: #667eea; font-weight: bold;\">â†’ Next: Lesson 1c - Logger Utility</p>"
        }
    ]
}