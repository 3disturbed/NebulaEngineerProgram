{
    "id": "lesson-4b",
    "title": "Lesson 4b: Building the Price Calculator",
    "steps": [
        {
            "title": "The PriceCalculator Class",
            "content": "<p>Now let's build the actual code to apply our formula. The <code>PriceCalculator</code> class will handle all price adjustments:</p><div class=\"code-block\"><code class=\"language-javascript\">class PriceCalculator {\n    constructor() {\n        this.maxChangePercent = 0.10; // 10% max change per tick\n    }\n\n    // Calculate new price based on demand\n    calculatePrice(currentPrice, demandRatio) {\n        // How much should price move?\n        const pressure = (demandRatio - 0.5) * 2;\n        const adjustment = currentPrice * pressure * this.maxChangePercent;\n        \n        // Return the new price\n        return currentPrice + adjustment;\n    }\n\n    // Adjust multiple items at once\n    adjustPrices(items, analyzer) {\n        // For each item, get demand and calculate new price\n        items.forEach(item => {\n            const demand = analyzer.getDemandRatio(item.name);\n            item.price = this.calculatePrice(item.price, demand);\n        });\n    }\n}</code></div><p style=\"margin-top: 15px;\"><strong>Key methods:</strong></p><ul style=\"margin: 10px 0 10px 20px;\"><li><code>calculatePrice()</code> - Adjust one item's price</li><li><code>adjustPrices()</code> - Update all items at once</li></ul>"
        },
        {
            "title": "Using the PriceCalculator",
            "content": "<p>Let's see it in action with the MarketAnalyzer:</p><div class=\"code-block\"><code class=\"language-javascript\">const calculator = new PriceCalculator();\nconst analyzer = new MarketAnalyzer();\n\n// Our market items\nconst items = [\n    { name: 'Iron Ore', price: 100, supply: 50, demand: 80 },\n    { name: 'Copper Ore', price: 75, supply: 60, demand: 60 },\n    { name: 'Uranium Ore', price: 500, supply: 20, demand: 2 }\n];\n\n// See current demand ratios\nanalyzer.analyzePrices(items);\nconsole.log(analyzer.getDemandRatio('Iron Ore'));    // ~0.62\nconsole.log(analyzer.getDemandRatio('Copper Ore'));  // 0.5\nconsole.log(analyzer.getDemandRatio('Uranium Ore')); // ~0.09\n\n// Adjust all prices based on demand\ncalculator.adjustPrices(items, analyzer);\n\n// Show new prices\nconsole.log('Iron Ore: $' + items[0].price.toFixed(2));    // $106\nconsole.log('Copper Ore: $' + items[1].price.toFixed(2));  // $75\nconsole.log('Uranium Ore: $' + items[2].price.toFixed(2)); // $460</code></div><div class=\"read-more\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach\" target=\"_blank\">MDN: Array.forEach()</a> - Iterate over array elements</div>"
        },
        {
            "title": "A Complete Market Tick",
            "content": "<p>A full market update combines both analyzer and calculator:</p><div class=\"code-block\"><code class=\"language-javascript\">// Market state\nconst marketItems = [\n    { name: 'Iron Ore', price: 100, supply: 50, demand: 80 },\n    { name: 'Copper Ore', price: 75, supply: 60, demand: 60 },\n    { name: 'Uranium Ore', price: 500, supply: 20, demand: 2 }\n];\n\nconst analyzer = new MarketAnalyzer();\nconst calculator = new PriceCalculator();\n\n// One complete market tick\nfunction updateMarket() {\n    // Step 1: Analyze current demand\n    analyzer.analyzePrices(marketItems);\n    \n    // Step 2: Calculate new prices\n    calculator.adjustPrices(marketItems, analyzer);\n    \n    // Step 3: Display results\n    console.log('Market Update:');\n    marketItems.forEach(item => {\n        const ratio = analyzer.getDemandRatio(item.name);\n        console.log(`${item.name}: $${item.price.toFixed(2)} (demand: ${(ratio*100).toFixed(0)}%)`);\n    });\n}\n\n// Run the update\nupdateMarket();</code></div><div class=\"read-more\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach\" target=\"_blank\">MDN: Array.forEach()</a> - Execute code for each item</div>"
        },
        {
            "title": "Lesson 4b Complete! ðŸŽ‰",
            "content": "<p style=\"font-size: 1.1em;\"><strong>You've built a working price calculator.</strong></p><div style=\"margin: 20px 0;\"><div class=\"achievement\">âœ“ Understand the PriceCalculator class</div><div class=\"achievement\">âœ“ Can combine analyzer and calculator</div><div class=\"achievement\">âœ“ Can execute complete market ticks</div></div><p style=\"margin-top: 20px; color: #667eea; font-weight: bold;\">â†’ Next: Lesson 5a - The Main Service Loop</p>"
        }
    ]
}
