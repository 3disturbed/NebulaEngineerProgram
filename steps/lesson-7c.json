{
    "id": "lesson-7c",
    "title": "Lesson 7c: Market Heatmaps",
    "steps": [
        {
            "title": "Visualizing Supply & Demand",
            "content": "<p>A <strong>heatmap</strong> uses colors to show data intensity. Perfect for comparing supply vs demand.</p><div class=\"info-box\"><strong>Color meanings:</strong><br>â€¢ <strong>Red/Hot:</strong> High demand, prices rising<br>â€¢ <strong>Blue/Cold:</strong> Low demand, prices falling<br>â€¢ <strong>Green/Neutral:</strong> Balanced market</div><p style=\"margin-top: 15px;\"><strong>Heatmap uses:</strong></p><ul style=\"margin: 10px 0 10px 20px;\"><li>Compare multiple items at once</li><li>Spot market opportunities quickly</li><li>Show historical patterns</li><li>Identify trends and anomalies</li></ul>"
        },
        {
            "title": "Color Mapping & Gradients",
            "content": "<p><strong>Map data values to colors:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">// Convert a value (0.0-1.0) to a color\nfunction valueToColor(value) {\n    // Clamp value between 0 and 1\n    value = Math.max(0, Math.min(1, value));\n    \n    if (value < 0.5) {\n        // Cold: Blue (low demand)\n        // Interpolate from blue to green\n        const t = value * 2;  // 0.0-1.0\n        const r = Math.floor(0 * (1 - t));\n        const g = Math.floor(150 * t);\n        const b = Math.floor(255 * (1 - t));\n        return `rgb(${r}, ${g}, ${b})`;\n    } else {\n        // Hot: Green to red (high demand)\n        const t = (value - 0.5) * 2;  // 0.0-1.0\n        const r = Math.floor(150 + 105 * t);  // 150 -> 255\n        const g = Math.floor(150 * (1 - t));  // 150 -> 0\n        const b = 0;\n        return `rgb(${r}, ${g}, ${b})`;\n    }\n}\n\n// Test\nconsole.log(valueToColor(0.0));   // Blue (cold)\nconsole.log(valueToColor(0.5));   // Green (neutral)\nconsole.log(valueToColor(1.0));   // Red (hot)</code></div><p style=\"margin-top: 15px;\"><strong>Advanced: Use HSL for smoother gradients:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">function valueToHSLColor(value) {\n    // Hue: 240 (blue) to 0 (red)\n    // Saturation: 100%\n    // Lightness: 50%\n    const hue = 240 * (1 - value);  // High value = red, low value = blue\n    const saturation = 100;\n    const lightness = 50;\n    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;\n}\n\n// Perfect color transition!\nconsole.log(valueToHSLColor(0.0));   // Blue\nconsole.log(valueToHSLColor(0.5));   // Cyan\nconsole.log(valueToHSLColor(1.0));   // Red</code></div><div class=\"read-more\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/hsl\" target=\"_blank\">MDN: HSL Color Model</a> - Intuitive color space</div>"
        },
        {
            "title": "Drawing a Grid Heatmap",
            "content": "<p><strong>Visualize multiple items and time periods as a grid:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">class MarketHeatmap {\n    constructor(canvasId) {\n        this.canvas = document.getElementById(canvasId);\n        this.items = ['Iron Ore', 'Copper Ore', 'Uranium Ore'];\n        this.data = {};\n        \n        // Initialize data\n        this.items.forEach(item => {\n            this.data[item] = [];\n        });\n    }\n    \n    // Add demand ratio for an item\n    addDemand(itemName, demandRatio) {\n        if (this.data[itemName]) {\n            this.data[itemName].push(demandRatio);\n            \n            // Keep last 24 hours\n            if (this.data[itemName].length > 24) {\n                this.data[itemName].shift();\n            }\n        }\n    }\n    \n    draw() {\n        const ctx = this.canvas.getContext('2d');\n        const padding = 80;\n        const cellWidth = (this.canvas.width - 2 * padding) / 24;\n        const cellHeight = (this.canvas.height - 2 * padding) / this.items.length;\n        \n        // Title\n        ctx.font = 'bold 20px Arial';\n        ctx.fillStyle = '#FFFFFF';\n        ctx.textAlign = 'center';\n        ctx.fillText('Market Demand Heatmap (24 Hours)', \n                     this.canvas.width / 2, 30);\n        \n        // Draw cells\n        for (let itemIdx = 0; itemIdx < this.items.length; itemIdx++) {\n            const itemName = this.items[itemIdx];\n            const demands = this.data[itemName];\n            \n            // Item label\n            ctx.font = '12px Arial';\n            ctx.textAlign = 'right';\n            ctx.fillStyle = '#AAAAAA';\n            ctx.fillText(itemName, padding - 10, \n                        padding + itemIdx * cellHeight + cellHeight / 2 + 4);\n            \n            // Draw cells for this item\n            for (let hour = 0; hour < demands.length; hour++) {\n                const x = padding + hour * cellWidth;\n                const y = padding + itemIdx * cellHeight;\n                const demand = demands[hour];\n                \n                // Color based on demand\n                ctx.fillStyle = valueToHSLColor(demand);\n                ctx.fillRect(x, y, cellWidth, cellHeight);\n                \n                // Border\n                ctx.strokeStyle = '#333333';\n                ctx.lineWidth = 1;\n                ctx.strokeRect(x, y, cellWidth, cellHeight);\n                \n                // Value on hover (optional)\n                if (hour % 6 === 0) {\n                    ctx.font = '10px Arial';\n                    ctx.fillStyle = '#FFFFFF';\n                    ctx.textAlign = 'center';\n                    ctx.fillText((demand * 100).toFixed(0) + '%',\n                                x + cellWidth / 2, \n                                y + cellHeight + 15);\n                }\n            }\n        }\n        \n        // Time axis labels\n        ctx.font = '10px Arial';\n        ctx.fillStyle = '#AAAAAA';\n        ctx.textAlign = 'center';\n        for (let hour = 0; hour < 24; hour += 4) {\n            const x = padding + hour * cellWidth + cellWidth / 2;\n            ctx.fillText(hour + 'h', x, \n                        this.canvas.height - padding + 20);\n        }\n    }\n}\n\n// Usage\nconst heatmap = new MarketHeatmap('heatmapCanvas');\nheatmap.addDemand('Iron Ore', 0.8);\nheatmap.addDemand('Copper Ore', 0.5);\nheatmap.addDemand('Uranium Ore', 0.2);\nheatmap.draw();</code></div><div class=\"read-more\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/fillRect\" target=\"_blank\">MDN: Canvas fillRect()</a> - Draw filled rectangles</div>"
        },
        {
            "title": "Interactive Heatmap with Tooltips",
            "content": "<p><strong>Add interactivity to show values on hover:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">class InteractiveHeatmap extends MarketHeatmap {\n    constructor(canvasId) {\n        super(canvasId);\n        this.hoveredCell = null;\n        \n        // Mouse move listener\n        this.canvas.addEventListener('mousemove', (e) => {\n            const rect = this.canvas.getBoundingClientRect();\n            const x = e.clientX - rect.left;\n            const y = e.clientY - rect.top;\n            \n            this.hoveredCell = this.getCellAt(x, y);\n            this.draw();\n        });\n        \n        this.canvas.addEventListener('mouseleave', () => {\n            this.hoveredCell = null;\n            this.draw();\n        });\n    }\n    \n    getCellAt(x, y) {\n        const padding = 80;\n        const cellWidth = (this.canvas.width - 2 * padding) / 24;\n        const cellHeight = (this.canvas.height - 2 * padding) / this.items.length;\n        \n        if (x < padding || y < padding) return null;\n        \n        const hour = Math.floor((x - padding) / cellWidth);\n        const itemIdx = Math.floor((y - padding) / cellHeight);\n        \n        if (hour >= 24 || itemIdx >= this.items.length) return null;\n        \n        return { hour, itemIdx };\n    }\n    \n    draw() {\n        super.draw();\n        \n        // Draw tooltip for hovered cell\n        if (this.hoveredCell) {\n            const { hour, itemIdx } = this.hoveredCell;\n            const itemName = this.items[itemIdx];\n            const demand = this.data[itemName][hour];\n            \n            // Tooltip background\n            const ctx = this.canvas.getContext('2d');\n            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';\n            ctx.fillRect(10, 10, 200, 50);\n            \n            // Tooltip text\n            ctx.fillStyle = '#FFFFFF';\n            ctx.font = 'bold 12px Arial';\n            ctx.textAlign = 'left';\n            ctx.fillText(itemName + ' at Hour ' + hour, 15, 30);\n            ctx.font = '11px Arial';\n            ctx.fillText('Demand: ' + (demand * 100).toFixed(1) + '%', 15, 45);\n        }\n    }\n}\n\n// Usage\nconst interactive = new InteractiveHeatmap('heatmapCanvas');</code></div><div class=\"read-more\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/mousemove_event\" target=\"_blank\">MDN: mousemove Event</a> - Track mouse movement</div>"
        },
        {
            "title": "Knowledge Check",
            "content": "<p>Verify your understanding of heatmaps.</p>",
            "quiz": [
                {
                    "question": "What is the primary purpose of a heatmap?",
                    "options": [
                        "To show the temperature of the computer",
                        "To visualize data intensity using colors",
                        "To draw a map of the world"
                    ],
                    "correct": 1
                },
                {
                    "question": "Why is the HSL color model useful for heatmaps?",
                    "options": [
                        "It allows for smooth transitions between colors (e.g., blue to red) by changing just the Hue value",
                        "It uses less memory than RGB",
                        "It is the only color model supported by Canvas"
                    ],
                    "correct": 0
                }
            ]
        },
        {
            "title": "Lesson 7c Complete! ðŸŽ‰",
            "content": "<p style=\"font-size: 1.1em;\"><strong>You've created professional data visualizations.</strong></p><div style=\"margin: 20px 0;\"><div class=\"achievement\">âœ“ Map values to colors</div><div class=\"achievement\">âœ“ Create grid-based heatmaps</div><div class=\"achievement\">âœ“ Use HSL for smooth gradients</div><div class=\"achievement\">âœ“ Add mouse interactivity</div><div class=\"achievement\">âœ“ Show tooltips on hover</div></div><p style=\"margin-top: 20px; color: #667eea; font-weight: bold;\">â†’ Next: Lesson 7d - 2D Coordinate Systems</p>"
        }
    ]
}
