{
    "id": "lesson-2c",
    "title": "Lesson 2c: Building the Database Class",
    "steps": [
        {
            "title": "Overview",
            "content": "<p>Now we'll build a simple <code>Database</code> class that wraps the file operations with the Safe Write Pattern.</p><div class=\"info-box\"><strong>Our Database class will:</strong><br>â€¢ Save data safely using temp files<br>â€¢ Read data from JSON files<br>â€¢ Handle errors gracefully<br>â€¢ Be easy to use everywhere in our code</div>"
        },
        {
            "title": "Create database.js",
            "content": "<p>Create the file <code>src/database.js</code>:</p><div class=\"code-block\"><code class=\"language-javascript\">const fs = require('fs').promises;\nconst path = require('path');\n\nclass Database {\n    constructor(dataDir) {\n        // Store the directory where all data files live\n        this.dataDir = dataDir;\n    }\n\n    /**\n     * Save data safely using the Safe Write Pattern\n     * \n     * @param {string} filename - Name of the file to save (e.g., 'markets.json')\n     * @param {object} data - The data to save (will be converted to JSON)\n     */\n    async saveFile(filename, data) {\n        // Step 1: Build paths\n        const filePath = path.join(this.dataDir, filename);\n        const tempPath = filePath + '.tmp';\n\n        try {\n            // Step 2: Write to temp file\n            await fs.writeFile(\n                tempPath,\n                JSON.stringify(data, null, 2)  // null, 2 = pretty-print with 2 spaces\n            );\n\n            // Step 3: Rename temp to real (Atomic!)\n            await fs.rename(tempPath, filePath);\n            \n            console.log(`âœ“ Saved ${filename} safely.`);\n        } catch (error) {\n            // If something goes wrong, at least the original file is untouched\n            console.error(`âœ— Failed to save ${filename}:`, error.message);\n            throw error;\n        }\n    }\n\n    /**\n     * Read data from a JSON file\n     * \n     * @param {string} filename - Name of the file to read\n     * @returns {object|null} The parsed data, or null if file doesn't exist\n     */\n    async readFile(filename) {\n        try {\n            const filePath = path.join(this.dataDir, filename);\n            const data = await fs.readFile(filePath, 'utf8');\n            return JSON.parse(data);\n        } catch (error) {\n            // File doesn't exist yet, or can't be parsed\n            return null;\n        }\n    }\n}\n\n// Export a singleton instance\n// Everyone in the app uses the SAME Database instance\nmodule.exports = new Database('./data');</code></div><div class=\"read-more\" style=\"margin-top: 15px; font-size: 0.9em;\"><strong>Read more on MDN:</strong><ul style=\"margin-top: 5px;\"><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify\" target=\"_blank\">JSON.stringify()</a></li><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse\" target=\"_blank\">JSON.parse()</a></li><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\" target=\"_blank\">Promise</a></li><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/try...catch\" target=\"_blank\">try...catch</a></li></ul></div>"
        },
        {
            "title": "Understanding the Code",
            "content": "<p><strong>Why use <code>path.join()</code>?</strong></p><div class=\"hint\">Different OS use different path separators:<br>Windows: <code>C:\\data\\markets.json</code><br>Mac/Linux: <code>/data/markets.json</code><br><br><code>path.join()</code> handles this automatically!</div><p style=\"margin-top: 15px;\"><strong>Why use <code>JSON.stringify(data, null, 2)</code>?</strong></p><div class=\"code-block\"><code class=\"language-javascript\">// Compact (hard to read):\n{\"price\":100,\"qty\":50}\n\n// Pretty (easy to debug in VS Code):\n{\n  \"price\": 100,\n  \"qty\": 50\n}</code></div><p style=\"margin-top: 15px;\">The <code>null</code> means \"don't filter properties\", and <code>2</code> means \"indent 2 spaces\".</p>"
        },
        {
            "title": "Using the Database",
            "content": "<p><strong>In your microservice code:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">const db = require('./src/database');\n\n// Save some data\nconst marketData = {\n    iron_ore: 100,\n    copper_ore: 75\n};\nawait db.saveFile('markets.json', marketData);\n\n// Load it back\nconst loaded = await db.readFile('markets.json');\nconsole.log(loaded);  // { iron_ore: 100, copper_ore: 75 }</code></div><div class=\"read-more\" style=\"margin-top: 15px; font-size: 0.9em;\"><strong>Read more on MDN:</strong><ul style=\"margin-top: 5px;\"><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" target=\"_blank\">async/await</a></li><li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" target=\"_blank\">await operator</a></li></ul></div>"
        },
        {
            "title": "Knowledge Check",
            "content": "<p>Verify your understanding of the Database class implementation.</p>",
            "quiz": [
                {
                    "question": "Why do we use `path.join()` instead of just adding strings together?",
                    "options": [
                        "It makes the code run faster",
                        "It handles different operating system path separators (\\ vs /) automatically",
                        "It encrypts the file path"
                    ],
                    "correct": 1
                },
                {
                    "question": "What does `JSON.stringify(data, null, 2)` do?",
                    "options": [
                        "Converts data to a string with 2-space indentation (pretty print)",
                        "Converts data to a string and encrypts it twice",
                        "Converts data to a string and removes null values"
                    ],
                    "correct": 0
                }
            ]
        },
        {
            "title": "Lesson 2c Complete! ðŸŽ‰",
            "content": "<p style=\"font-size: 1.1em;\"><strong>You've built a safe, reusable database wrapper.</strong></p><div style=\"margin: 20px 0;\"><div class=\"achievement\">âœ“ Created Database class</div><div class=\"achievement\">âœ“ Implemented Safe Write Pattern</div><div class=\"achievement\">âœ“ Handle file errors gracefully</div></div><p style=\"margin-top: 20px; color: #667eea; font-weight: bold;\">â†’ Next: Lesson 2d - Testing the Database</p>"
        }
    ]
}
