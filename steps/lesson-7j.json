{
    "id": "lesson-7j",
    "title": "Lesson 7j: Complete Game Interface",
    "steps": [
        {
            "title": "Connecting UI to State",
            "content": "<p>The UI should be a reflection of the state, not a storage of it.</p><div class=\"info-box\"><strong>Reactive UI Pattern:</strong><br>1. State changes (e.g., credits update)<br>2. State notifies listeners<br>3. UI receives notification<br>4. UI re-renders relevant parts</div><p style=\"margin-top: 15px;\"><strong>Benefits:</strong></p><ul style=\"margin: 10px 0 10px 20px;\"><li>Decoupled code (UI doesn't know game logic)</li><li>No \"sync\" bugs (UI is always up to date)</li><li>Easy to add new views (just subscribe)</li></ul>"
        },
        {
            "title": "The GameUI Class",
            "content": "<p><strong>Create the view controller:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">class GameUI {\n    constructor(gameState) {\n        this.state = gameState;\n        // Subscribe to state changes\n        this.state.subscribe(() => this.render());\n        \n        // Cache DOM elements\n        this.elements = {\n            credits: document.getElementById('credits'),\n            inventory: document.getElementById('inventory'),\n            position: document.getElementById('position'),\n            events: document.getElementById('eventLog')\n        };\n    }\n    \n    render() {\n        // Update credits\n        this.elements.credits.textContent = \n            Math.floor(this.state.player.credits).toLocaleString();\n            \n        // Update position\n        const pos = this.state.navigation.position;\n        this.elements.position.textContent = \n            `(${pos.x.toFixed(1)}, ${pos.y.toFixed(1)})`;\n            \n        // Update inventory list\n        let inventoryHtml = '';\n        this.state.player.inventory.forEach((qty, item) => {\n            inventoryHtml += `<div class=\"inv-item\">${item}: ${qty}</div>`;\n        });\n        this.elements.inventory.innerHTML = inventoryHtml || 'Empty';\n        \n        // Update event log\n        const recentEvents = this.state.history.slice(-5).reverse();\n        this.elements.events.innerHTML = recentEvents.map(e => \n            `<div class=\"log-entry\">\n                <span class=\"time\">${Math.floor(e.time)}h:</span> ${e.message}\n            </div>`\n        ).join('');\n    }\n}</code></div>"
        },
        {
            "title": "Handling User Input",
            "content": "<p><strong>Connect forms and buttons to game actions:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">    // Add to GameUI class\n    setupInputs() {\n        // Buy Form\n        document.getElementById('buyForm').addEventListener('submit', (e) => {\n            e.preventDefault();\n            const commodity = document.getElementById('buyCommodity').value;\n            const quantity = parseInt(document.getElementById('buyQuantity').value);\n            const price = this.state.market.prices[commodity];\n            \n            if (!price) {\n                alert('Commodity not available');\n                return;\n            }\n            \n            const success = this.state.buyItem(commodity, quantity, price);\n            if (!success) {\n                alert('Insufficient credits!');\n            }\n        });\n        \n        // Map Clicks\n        const canvas = document.getElementById('galaxyCanvas');\n        canvas.addEventListener('click', (e) => {\n            // Convert screen click to game coordinates\n            // (Simplified for example)\n            const rect = canvas.getBoundingClientRect();\n            const x = (e.clientX - rect.left) / 10;\n            const y = (e.clientY - rect.top) / 10;\n            \n            this.state.navigation.target = { x, y };\n            this.state.navigation.traveling = true;\n        });\n    }</code></div>"
        },
        {
            "title": "Final Integration",
            "content": "<p><strong>Put it all together in your main script:</strong></p><div class=\"code-block\"><code class=\"language-javascript\">// 1. Create State\nconst gameState = new GameState();\n\n// 2. Setup Initial Data\ngameState.market.prices = {\n    'Iron Ore': 100,\n    'Gold': 250,\n    'Water': 50\n};\n\n// 3. Create UI\nconst ui = new GameUI(gameState);\nui.setupInputs();\n\n// 4. Create Engine\nconst engine = new GameEngine(gameState);\n\n// 5. Start Game\nengine.start();\n\nconsole.log('Game initialized!');</code></div>"
        },
        {
            "title": "Knowledge Check",
            "content": "<p>Verify your understanding of the game interface integration.</p>",
            "quiz": [
                {
                    "question": "In the Reactive UI Pattern described, what triggers the UI to re-render?",
                    "options": [
                        "A timer that runs every second",
                        "A notification from the Game State that data has changed",
                        "The user clicking a button"
                    ],
                    "correct": 1
                },
                {
                    "question": "Why is it beneficial to decouple the UI from the game logic?",
                    "options": [
                        "It prevents 'sync' bugs where the UI shows old data",
                        "It makes it easier to add new views without changing the core logic",
                        "Both of the above"
                    ],
                    "correct": 2
                }
            ]
        },
        {
            "title": "Lesson 7j Complete! ðŸŽ‰",
            "content": "<p style=\"font-size: 1.1em;\"><strong>Congratulations! You have built a complete game engine.</strong></p><div style=\"margin: 20px 0;\"><div class=\"achievement\">âœ“ Reactive UI architecture</div><div class=\"achievement\">âœ“ User input handling</div><div class=\"achievement\">âœ“ Full system integration</div><div class=\"achievement\">âœ“ Playable game loop</div></div><p style=\"margin-top: 20px; color: #667eea; font-weight: bold; font-size: 1.2em;\">ðŸŽ“ COURSE COMPLETE: YOU ARE NOW A NEBULA ENGINEER!</p><p style=\"margin-top: 15px;\">You have mastered:</p><ul style=\"margin: 10px 0 10px 20px;\"><li>Node.js Microservices</li><li>Data Persistence</li><li>Market Economics</li><li>REST APIs & WebSockets</li><li>Canvas Graphics</li><li>Game Architecture</li></ul>"
        }
    ]
}
